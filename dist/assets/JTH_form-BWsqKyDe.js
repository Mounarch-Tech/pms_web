import{m as e,a as o,e as Z,E as ee,S as te,h as G,o as se,U as ne,P as oe,p as ie,q as le,n as z}from"./index-YC0knlYH.js";const ce=({currentPage:l,totalPages:c,onPageChange:p,maxVisiblePages:h=5})=>{if(c<=1)return null;const _=(()=>{const d=[];let b,r;if(c<=h)b=1,r=c;else{const f=Math.floor(h/2),T=Math.ceil(h/2)-1;l<=f?(b=1,r=h):l+T>=c?(b=c-h+1,r=c):(b=l-f,r=l+T)}for(let f=b;f<=r;f++)d.push(f);return d})();return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>p(l-1),disabled:l===1,className:"pagination-btn",children:"Previous"}),_[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(1),className:`pagination-btn ${l===1?"active":""}`,children:"1"}),_[0]>2&&e.jsx("span",{className:"pagination-ellipsis",children:"..."})]}),_.map(d=>e.jsx("button",{onClick:()=>p(d),className:`pagination-btn ${l===d?"active":""}`,"aria-label":`Go to page ${d}`,children:d},d)),_[_.length-1]<c&&e.jsxs(e.Fragment,{children:[_[_.length-1]<c-1&&e.jsx("span",{className:"pagination-ellipsis",children:"..."}),e.jsx("button",{onClick:()=>p(c),className:`pagination-btn ${l===c?"active":""}`,children:c})]}),e.jsx("button",{onClick:()=>p(l+1),disabled:l===c,className:"pagination-btn",children:"Next"})]})},re=({onProceed:l,onCancel:c,jobTypeName:p,jobTypeID:h})=>{const[m,_]=o.useState(!1),{plannedJobList:d,refreshPlannedJobs:b}=o.useContext(Z),{executedJobList:r,refreshExecutedJobs:f}=o.useContext(ee),{shipsList:T,refreshShipsList:w}=o.useContext(te),{JCD_schedule_List:O,refreshJCDSchedules:A}=o.useContext(G),{JCD_ship_combinations_list:v,refreshJCD_ship_combinations_list:P}=o.useContext(se);return o.useEffect(()=>{},[]),e.jsx("div",{className:"terms-conditions-overlay",children:e.jsxs("div",{className:"terms-conditions-modal",children:[e.jsx("div",{className:"terms-conditions-header",children:e.jsxs("h1",{className:"terms-conditions-title",children:["Selected Job Type: ",e.jsx("span",{className:"job-type-name",children:p})]})}),e.jsxs("div",{className:"terms-conditions-content",children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"terms-conditions-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Check Locations"}),e.jsx("th",{scope:"col",children:"No. of Active Jobs"}),e.jsx("th",{scope:"col",children:"No. of Completed Jobs"}),e.jsx("th",{scope:"col",children:"Upcoming Jobs"})]})}),e.jsx("tbody",{children:T&&T.length>0?T.map(j=>{const I=d?.filter(a=>a.SHA_ID==j.SHA_ID&&a.JTH_ID==h)?.length||0,L=r?.filter(a=>d?.some(x=>a.JPHA_ID===x.JPHA_ID&&x.SHA_ID===j.SHA_ID&&x.JTH_ID==h))?.length||0,u=v.filter(a=>a.SHA_ID===j.SHA_ID).reduce((a,x)=>{let g=0;for(let y=1;y<=100;y++){const E=`jcd_id${y}`,S=x[E];if(!S)continue;const H=O?.find(J=>J.JCD_ID===S);if(!H||H.JTH_ID!==h)continue;d?.some(J=>J.JCD_ID===S&&J.SHA_ID===j.SHA_ID&&J.job_status!=4)||g++}return a+g},0);return e.jsxs("tr",{children:[" ",e.jsx("td",{children:e.jsxs("label",{className:"ship-checkbox-label",children:[" ",e.jsx("input",{type:"checkbox",className:"ship-checkbox",id:`ship-${j.SHA_ID}`}),e.jsx("span",{className:"ship-name",children:j.ship_code})," "]})}),e.jsx("td",{className:"job-count-cell",children:I}),e.jsx("td",{className:"job-count-cell",children:L}),e.jsx("td",{className:"job-count-cell",children:u})]},j.SHA_ID)}):e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"no-data-cell",children:[" ","No locations available."]})})})]})}),e.jsxs("div",{className:"terms-conditions-footer",children:[" ",e.jsxs("label",{htmlFor:"read_terms_conditions_chkbox",className:"terms-checkbox-label",children:[" ",e.jsx("input",{type:"checkbox",id:"read_terms_conditions_chkbox",className:"terms-checkbox",required:!0,onChange:j=>{_(j.target.checked)}}),e.jsxs("span",{className:"terms-text",children:[" ","I confirm that I have read and understood the terms and conditions."]})]}),e.jsxs("div",{className:"terms-conditions-buttons",children:[" ",e.jsx("button",{className:`action-button proceed-button ${m?"":"disabled"}`,onClick:()=>{m?l():alert("Please confirm the terms and conditions.")},children:"Proceed"}),e.jsx("button",{className:"action-button cancel-button",onClick:c,children:"Cancel"})]})]})]})]})})},de=()=>{const{user:l}=o.useContext(ne),{profiles:c}=o.useContext(oe),[p,h]=o.useState(null),[m,_]=o.useState(null),[d,b]=o.useState("none"),[r,f]=o.useState("asc"),[T,w]=o.useState(!1),[O,A]=o.useState(!1),v=o.useRef(null);o.useRef(null);const{JCD_schedule_List:P,refreshJCDSchedules:j}=o.useContext(G),{jobTypesList:I,refreshJobTypes:L}=o.useContext(ie),[u,a]=o.useState({}),[x,g]=o.useState(1),y=5,E="https://udayerp.com/pms/server/api/";o.useEffect(()=>{const t=n=>{v.current&&!v.current.contains(n.target)&&(_(null),f("asc"))};return document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0)}},[]);let S=[...I].sort((t,n)=>{if(!m)return 0;let i=t[m],s=n[m];return i==null&&s==null?0:i==null?r==="asc"?1:-1:s==null||(i=i?.toString().toLowerCase(),s=s?.toString().toLowerCase(),i<s)?r==="asc"?-1:1:i>s?r==="asc"?1:-1:0});const H=t=>{m===t?f(n=>n==="asc"?"desc":"asc"):(_(t),f("asc")),g(1)},D=o.useRef(null),J=o.useRef(null);let[F,R]=o.useState("-120%");o.useEffect(()=>{console.log("PopUp changed to:",F),F==="20%"&&setTimeout(()=>{R("-120%")},2e3)},[F]);const N=t=>{let{name:n,value:i}=t.target;if(n==="JTH_time_limit"&&!Y(i)){alert("Date should be future date only"),a(s=>({...s,[n]:""}));return}if(n==="JTH_status"){const s=parseInt(i),C=u.JTH_status;if(s!==C){A(!0),h({field:n,value:s,oldValue:C});return}}a(s=>({...s,[n]:i}))},Y=t=>{const n=new Date(t),i=new Date;return i.setHours(0,0,0,0),n.setHours(0,0,0,0),!(n<=i)},K=t=>{t.preventDefault();const n={...u,JTH_job_short_name:u.JTH_job_short_name?.toUpperCase()};$(n)},U=(t,n)=>{J.current&&(J.current.innerText=t),R("20%")},Q=(t,n)=>{D.current&&(D.current.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{D.current&&D.current.focus()},600)),a(n),b("flex"),console.log(n)},$=async t=>{if(I.find(i=>i.JTH_ID===t.JTH_ID)){const i=typeof t.JTH_status=="object"&&t.JTH_status?.data?t.JTH_status.data[0]:t.JTH_status,s={...t,JTH_status:i};if((s.JTH_job_short_name?.length||0)<3){alert("Code at least have 3 Characters.."),a(C=>({...C,JTH_job_short_name:""}));return}try{(await z.put(`${E}updatejth`,s)).status===200&&(a({}),U("Job updated successfully","limegreen"),b("none"),L(),console.log("Job updated successfully"))}catch(C){console.log("Update Error:",C)}}else try{const i=String(I.length+1).padStart(4,"0"),s={...t,JTH_ID:`JTH_${i}`,JTH_status:1};(await z.post(`${E}addjth`,s)).status===200?(a({}),L(),U("New job added successfully","limegreen"),console.log("New job added successfully")):alert("All Fields Are Required !!")}catch(i){alert("Cannot Insert Duplicate JobTypes.."),console.log("Submit Error:",i)}},W=(t,n)=>{confirm(`Do You really want to Delete this Job Type : ${n.JTH_job_type}`)&&alert("Currently disable the deleting functionality, working on searching logic for any active job are there of this job type which you are going to delete")},M=S.length,k=Math.ceil(M/y);o.useEffect(()=>{x>k&&k>0?g(k):x<1&&g(1)},[x,k]);const q=x*y,B=q-y,V=S.slice(B,q),X=t=>{g(t),document.getElementById("JTH-show-table-container")?.scrollIntoView({behavior:"smooth",block:"nearest"})};return e.jsxs("div",{id:"JTH-main-container",children:[O&&e.jsx(re,{onProceed:()=>{A(!1),w(!0)},onCancel:()=>{A(!1)},jobTypeName:u.JTH_job_type,jobTypeID:u.JTH_ID}),T&&e.jsx(le,{to:l.emp_email,onVerifySuccess:()=>{if(p){const{field:t,value:n}=p;a(i=>({...i,[t]:n})),$({...u,[t]:n,JTH_job_short_name:u.JTH_job_short_name?.toUpperCase()})}h(null),w(!1)},onCancel:()=>{h(null),w(!1)}}),e.jsx("div",{id:"JTH-form-popup-container",style:{transform:`translate(0%, ${F})`},children:e.jsx("p",{ref:J,id:"JTH-form-popup-message"})}),c?.filter(t=>l?.profile_ids?.includes(t.PROFILE_ID))[0]?.form_ids?.includes("F_JTH_001")&&e.jsx("div",{id:"JTH-add-from-container",children:e.jsxs("form",{id:"JTH-form-container",onSubmit:K,children:[e.jsxs("div",{className:"form-field-container",children:[e.jsx("label",{htmlFor:"JobType",children:"Job Type"}),e.jsx("input",{required:!0,ref:D,onChange:N,type:"text",id:"JobType",name:"JTH_job_type",value:u.JTH_job_type||"",placeholder:"Define the name"})]}),e.jsxs("div",{className:"form-field-container",children:[e.jsx("label",{htmlFor:"JTH_job_short_name",children:"Job Short Name"}),e.jsx("input",{required:!0,onChange:N,type:"text",id:"JTH_job_short_name",value:u.JTH_job_short_name||"",maxLength:3,name:"JTH_job_short_name",placeholder:"Enter 3 character"})]}),e.jsxs("div",{className:"form-field-container",children:[e.jsx("label",{htmlFor:"JTH_time_limit",children:"Job Time Limit"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"50%"},children:[e.jsx("input",{required:!0,onChange:N,type:"date",id:"JTH_time_limit",name:"JTH_time_limit",value:u.JTH_time_limit||"",min:new Date().toISOString().split("T")[0],style:{width:"100%"}}),e.jsx("small",{style:{textAlign:"left",color:"white",fontSize:"11px"},children:"Date should be future date only"})]})]}),e.jsxs("div",{className:"form-field-container",style:{display:d},children:[e.jsx("label",{children:"Job Status"}),e.jsxs("span",{id:"JTH-form-radio-group-container",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"JTH_status",value:1,checked:u.JTH_status==1,onChange:N})," Active"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"JTH_status",value:0,checked:u.JTH_status==0,onChange:N})," Inactive"]})]}),e.jsx("small",{style:{color:"#ffd700",fontSize:"12px"},children:"OTP verification required to change status."})]}),c?.filter(t=>l?.profile_ids?.includes(t.PROFILE_ID))[0]?.process_ids.includes("P_JTH_0002")&&e.jsx("button",{type:"submit",id:"FTH-btn-submit",children:"Save"}),e.jsx("button",{type:"reset",id:"FTH-btn-submit",style:{backgroundColor:"crimson",color:"white"},onClick:()=>{a({}),b("none")},children:"Clear"})]})}),e.jsxs("div",{id:"JTH-show-table-container",children:[e.jsxs("table",{children:[e.jsx("thead",{ref:v,children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>H("JCD_count"),children:["JCD Count ",m==="JCD_count"&&(r==="asc"?"▲":"▼")]}),e.jsxs("th",{onClick:()=>H("JTH_job_type"),children:["Job Type ",m==="JTH_job_type"&&(r==="asc"?"▲":"▼")]}),e.jsxs("th",{onClick:()=>H("JTH_job_short_name"),children:["Job Code ",m==="JTH_job_short_name"&&(r==="asc"?"▲":"▼")]}),e.jsxs("th",{onClick:()=>H("JTH_time_limit"),children:["Last Date ",m==="JTH_time_limit"&&(r==="asc"?"▲":"▼")]}),e.jsxs("th",{onClick:()=>H("JTH_status"),children:["Job Status ",m==="JTH_status"&&(r==="asc"?"▲":"▼")]}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:V.length>0?V.map((t,n)=>{const i=B+n;return e.jsxs("tr",{children:[" ",e.jsx("td",{children:P.filter(s=>s.JTH_ID==t.JTH_ID&&s.SHA_ID!=null).length}),e.jsx("td",{children:t.JTH_job_type}),e.jsx("td",{children:t.JTH_job_short_name}),e.jsx("td",{children:t.JTH_time_limit?new Date(t.JTH_time_limit).toLocaleDateString("en-GB"):""}),e.jsx("td",{children:t.JTH_status==1?"Active":"Inactive"}),e.jsxs("td",{className:"FTH-ED-btn-container",children:[c?.filter(s=>l?.profile_ids?.includes(s.PROFILE_ID))[0]?.process_ids.includes("P_JTH_0003")&&e.jsx("button",{id:"FTH-btn-edit",onClick:s=>{Q(s,t)},children:"Edit"}),c?.filter(s=>l?.profile_ids?.includes(s.PROFILE_ID))[0]?.process_ids.includes("P_JTH_0005")&&e.jsx("button",{id:"FTH-btn-delete",onClick:s=>{W(s,t)},children:"Suspend"})]})]},t.JTH_ID||i)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:M>0?"No data for this page.":"Loading..."})})})]}),e.jsx(ce,{currentPage:x,totalPages:k,onPageChange:X,maxVisiblePages:100})]})]})};export{de as default};
