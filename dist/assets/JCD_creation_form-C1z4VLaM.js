import{a as o,U as B,D as W,k as G,o as M,l as e,m as S}from"./index-0Zuh0jOl.js";const Y=({selected_jcd_from_view_jcd_module:h,toggelVeiwJobsOnJCD:C,refreshClickedJcdData:P})=>{const k="https://udayerp.com/pms/server/api/",{user:g}=o.useContext(B),{designationList:I,refreshDesignationList:w}=o.useContext(W),{selectedNode:m}=o.useContext(G),n=h&&g.emp_type===1,{jobTypesIDandNameList:J,refreshJobTypesIDandName:T}=o.useContext(M),[y,N]=o.useState(!1),[b,x]=o.useState([]),[f,D]=o.useState(!1),[_,v]=o.useState([""]),[l,p]=o.useState({JTH_ID:"",SHA_ID:"",criticality:"",job_generation_type:[],operational_interval:"",time_scale:"",km_interval:"",periodic_interval:"",jcd_category:"",jcd_instruction_manual:null,jcd_check_list:[],status:"1",deactivated_by:"",deactivated_on:"",job_will_generate_on:[],lest_executed_status:"",consumable_spare1:"",consumable_spare2:"",consumable_spare3:"",consumable_spare4:"",consumable_spare5:"",consumable_spare6:"",consumable_spare7:"",consumable_spare8:"",consumable_spare9:"",consumable_spare10:"",executed_by:"",secondary_desg:"",first_verified_by:"",second_verified_by:"",image_required:"",video_required:"",extension_authority:"",jcd_applied_cat:"",jcd_applied_sub_cat:"",jcd_applied_2nd_sub_cat:"",jcd_applied_3rd_sub_cat:"",jcd_applied_part:""});o.useEffect(()=>{if(h){const a={...h};typeof a.job_generation_type=="string"&&(a.job_generation_type=a.job_generation_type.split(",").map(t=>t.trim())),typeof a.job_will_generate_on=="string"&&(a.job_will_generate_on=a.job_will_generate_on.split(",").map(t=>t.trim())),typeof a.jcd_check_list=="string"&&(a.jcd_check_list=a.jcd_check_list.split(",").map(t=>t.trim())),p(t=>q(a,t))}},[h]);function q(a,t){const s={...t};for(const i in a){if(!(i in t))continue;const r=a[i];["job_generation_type","job_will_generate_on","jcd_check_list"].includes(i)?typeof r=="string"?s[i]=r.split(",").map(c=>c.trim()).filter(Boolean):Array.isArray(r)?s[i]=r:s[i]=[]:s[i]=r}return s}o.useEffect(()=>{},[m]),o.useEffect(()=>{T(),w()},[]);const u=a=>{const{name:t,value:s,type:i,checked:r}=a.target;n||p(i==="checkbox"&&t==="job_generation_type"?c=>{const d=[...c.job_generation_type];if(r)d.push(s);else{const j=d.indexOf(s);j>-1&&d.splice(j,1)}return{...c,job_generation_type:d}}:i==="checkbox"?c=>{const d=[...c.job_will_generate_on];if(r)d.push(s);else{const j=d.indexOf(s);j>-1&&d.splice(j,1)}return{...c,job_will_generate_on:d}}:c=>({...c,[t]:s}))},H=a=>{if(n)return;const t=a.target.value,s=a.target.checked;p(i=>{const r=Array.isArray(i.job_generation_type)?i.job_generation_type:[],c=s?[...r,t]:r.filter(d=>d!==t);return{...i,job_generation_type:c}})},A=a=>{if(n)return;const t=a.target.files[0];p(s=>({...s,jcd_instruction_manual:t}))},E=(a,t)=>{if(n)return;const s=[...b];s[a]=t,x(s)},F=()=>{n||x([...b,""])},O=a=>{if(n||b.length<=1)return;const t=b.filter((s,i)=>i!==a);x(t)},R=()=>{n||_.length>=10||v([..._,""])},L=a=>{if(n||_.length<=1)return;const t=_.filter((i,r)=>r!==a);v(t);const s=`consumable_spare${a+1}`;p(i=>({...i,[s]:""}))},$=async a=>{if(a.preventDefault(),n){C("flex");return}if(l.job_generation_type.length===0){alert("Please select at least one Job Generation Type.");return}let t={...l};l.status==="2"&&(t.deactivated_by=g.EHA_ID,t.deactivated_on=new Date().toISOString().split("T")[0]),t.jcd_check_list=y?b:[],_.forEach((s,i)=>{const r=`consumable_spare${i+1}`;t[r]=l[r]||""});for(let s=_.length;s<10;s++)t[`consumable_spare${s+1}`]="";t.jcd_applied_cat=m.data.CHA_ID??null,t.jcd_applied_sub_cat=m.data.SCHA_ID??null,t.jcd_applied_2nd_sub_cat=m.data.SSCHA_ID??null,t.jcd_applied_3rd_sub_cat=m.data.TSCHA_ID??null,t.inserted_by=g.EHA_ID,t.inserted_on=new Date().toISOString().split("T")[0];try{if(h){t.JCDSHA_ID=h.JCDSHA_ID;const s=await S.put(`${k}updateJCDScheduleById`,t);alert(s.status===200?"JCD updated successfully!":"Unexpected response")}else{const s=await S.post(`${k}addJcd`,t);alert(s.status===200?"JCD saved successfully!":"Unexpected response")}}catch(s){console.error(s),alert("Error saving JCD.")}},U=()=>{p({JTH_ID:"",SHA_ID:"",criticality:"",job_generation_type:[],operational_interval:"",time_scale:"",km_interval:"",periodic_interval:"",jcd_category:"",jcd_instruction_manual:null,jcd_check_list:[],status:"1",deactivated_by:"",deactivated_on:"",job_will_generate_on:[],lest_executed_status:"",consumable_spare1:"",consumable_spare2:"",consumable_spare3:"",consumable_spare4:"",consumable_spare5:"",consumable_spare6:"",consumable_spare7:"",consumable_spare8:"",consumable_spare9:"",consumable_spare10:"",executed_by:"",secondary_desg:"",first_verified_by:"",second_verified_by:"",image_required:"",video_required:"",extension_authority:"",jcd_applied_cat:"",jcd_applied_sub_cat:"",jcd_applied_2nd_sub_cat:"",jcd_applied_3rd_sub_cat:"",jcd_applied_part:""}),N(!1),x([""]),D(!1),v([""])};return e.jsxs("div",{className:"jcd-main-container",children:[e.jsxs("h2",{children:["Configure Job On ",m.data.label.split(":")[0]]}),n&&e.jsxs("div",{className:"view-only-banner",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),"View-only mode: You are a location-side user and cannot edit this JCD."]}),e.jsxs("form",{onSubmit:$,className:"jcd-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selected Component:"}),e.jsx("big",{children:e.jsx("i",{style:{color:"#94a3b8"},children:m.data.label})})]}),e.jsx("div",{className:"form-group",children:e.jsxs("select",{name:"JTH_ID",onChange:u,value:l.JTH_ID,required:!0,disabled:n,className:"form-control",children:[e.jsx("option",{value:"",children:"Select Job Type"}),J.map(a=>e.jsx("option",{value:a.JTH_ID,children:a.JTH_job_type},a.JTH_ID))]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Criticality"}),["Critical","Non-critical"].map((a,t)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"criticality",value:t+1,checked:l.criticality==t+1,onChange:u,disabled:n,required:!0}),a]},a))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Generation Type"}),e.jsx("div",{className:"checkbox-group",children:[{value:"1",label:"Operational Time"},{value:"2",label:"KM"},{value:"3",label:"Periodic Days"}].map(({value:a,label:t})=>e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",value:a,checked:l.job_generation_type.includes(a),onChange:H,disabled:n}),t]},a))})]}),l.job_generation_type.includes("1")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"operational_interval",children:"Operational Interval"}),e.jsx("input",{type:"number",id:"operational_interval",name:"operational_interval",value:l.operational_interval,onChange:u,className:"form-control",disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"time_scale",children:"Time Scale"}),e.jsxs("select",{id:"time_scale",name:"time_scale",value:l.time_scale,onChange:u,className:"form-control",disabled:n,children:[e.jsx("option",{value:"",children:"Select Scale"}),e.jsx("option",{value:"1",children:"Hours"}),e.jsx("option",{value:"2",children:"Days"}),e.jsx("option",{value:"3",children:"Weeks"})]})]})]}),l.job_generation_type.includes("2")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"km_interval",children:"KM Interval"}),e.jsx("input",{type:"number",id:"km_interval",name:"km_interval",value:l.km_interval,onChange:u,className:"form-control",disabled:n})]}),l.job_generation_type.includes("3")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"periodic_interval",children:"Periodic Interval (Days)"}),e.jsx("input",{type:"number",id:"periodic_interval",name:"periodic_interval",value:l.periodic_interval,onChange:u,className:"form-control",disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Servicable Or Replacable"}),e.jsxs("select",{name:"jcd_category",onChange:u,value:l.jcd_category,required:!0,disabled:n,className:"form-control",children:[e.jsx("option",{value:"",children:"Select"}),[{value:"1",label:"Servicable"},{value:"2",label:"Replacable"}].map((a,t)=>e.jsx("option",{value:a.value,children:a.label},t))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Instruction Manual"}),e.jsx("input",{type:"file",name:"jcd_instruction_manual",accept:".pdf, .doc",onChange:A,disabled:n})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:y,onChange:a=>!n&&N(a.target.checked),disabled:n}),"Do you want to add checklist to ensure quality work?"]})}),y&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Checklist Items"}),e.jsx("div",{className:"checklist-container",children:b.map((a,t)=>e.jsxs("div",{className:"checklist-item",children:[e.jsx("input",{type:"text",value:a,onChange:s=>E(t,s.target.value),disabled:n,placeholder:`Checklist ${t+1}`,className:"form-control",required:!0}),e.jsx("button",{type:"button",onClick:()=>O(t),disabled:n,children:"Remove"})]},t))}),e.jsxs("button",{type:"button",onClick:F,className:"add-button",disabled:n,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Checklist Item"]})]}),["executed_by","secondary_desg","first_verified_by","second_verified_by","extension_authority"].map(a=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:a,children:a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsxs("select",{id:a,name:a,onChange:u,value:l[a],className:"form-control",required:a!=="extension_authority",style:{color:"#666464"},disabled:n,children:[e.jsxs("option",{value:"",children:["Select ",a.replace(/_/g," ")]}),I.map((t,s)=>e.jsx("option",{value:t.DSGH_ID,children:t.desg_name},s))]})]},a)),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image Required"}),[1,0].map(a=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"image_required",value:a,checked:l.image_required==a,onChange:u,disabled:n,required:!0}),a===1?"Yes":"No"]},a))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Video Required"}),[1,0].map(a=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"video_required",value:a,checked:l.video_required==a,onChange:u,disabled:n,required:!0}),a===1?"Yes":"No"]},a))]}),l.jcd_category==="Replaceable"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:f,onChange:a=>!n&&D(a.target.checked),disabled:n}),"Do you need any consumable spares to complete this job?"]})}),f&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontWeight:"bold",marginBottom:"8px",display:"block"},children:"Consumable Spares"}),e.jsx("div",{className:"checklist-container",children:_.map((a,t)=>{const s=`consumable_spare${t+1}`;return e.jsxs("div",{className:"checklist-item",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:`Consumable Spare ${t+1}`,value:l[s],onChange:i=>!n&&p(r=>({...r,[s]:i.target.value})),disabled:n,required:f}),e.jsx("button",{type:"button",onClick:()=>L(t),disabled:n,children:"Remove"})]},s)})}),_.length<10&&e.jsxs("button",{type:"button",onClick:R,className:"add-button",disabled:n,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add More"]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",disabled:n,children:n?"View Only":h?"Update":"Create"}),e.jsx("button",{type:"button",onClick:U,disabled:n,children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>C("flex"),disabled:n,children:"View jobs Count On this JCD"})]})]})]})};export{Y as default};
