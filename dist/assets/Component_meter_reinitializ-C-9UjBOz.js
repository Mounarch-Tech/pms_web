import{a as s,S as I,l as S,U as N,P as D,m as e,s as k,F as A}from"./index-YC0knlYH.js";const M=()=>{const{shipsList:j}=s.useContext(I),{selectedNode:t,clearSelection:v,refreshTree:_}=s.useContext(S),C="https://udayerp.com/pms/server/api/",{user:l}=s.useContext(N),{profiles:p}=s.useContext(D),d={shipId:"",rh:"",nm:"",idl:"",isMovementLogAffect:0,impactOn:0,selectedNodeId:"",component_type:"",childs:[]},[i,a]=s.useState(d),[o,u]=s.useState(null);s.useEffect(()=>{a(t?n=>({...n,rh:Number(t?.data?.working_counter_hr||0),nm:Number(t?.data?.km_counter||0),idl:Number(t?.data?.replacement_day_counter||0),isMovementLogAffect:0,impactOn:0,selectedNodeId:t.id||"",component_type:t.type||"",childs:t.children||[]}):n=>({...n,rh:"",nm:"",idl:"",isMovementLogAffect:0,impactOn:0,selectedNodeId:"",component_type:"",childs:[]}))},[t]),s.useEffect(()=>{a({...d,shipId:o}),v()},[o]),s.useEffect(()=>{l.emp_type==1&&u(l.ship_id)},[l]);const m=(n,r)=>{a(c=>({...c,[n]:r===""?"":Number(r)}))},y=n=>{const r=n.target.checked;a(c=>({...c,isMovementLogAffect:r?1:0,impactOn:0}))},x=n=>{a(r=>({...r,impactOn:Number(n.target.value)}))},b=n=>{const r=n.target.value;u(r),a(c=>({...c,shipId:r}))},h=n=>{["e","E","+","-"].includes(n.key)&&n.preventDefault()},f=()=>{a({...d,shipId:o})},g=async n=>{if(n.preventDefault(),!i.shipId)return alert("Please select a ship");if(i.rh===""||i.nm===""||i.idl==="")return alert("Please fill all meter values");try{const c=await(await fetch(`${C}reInitiateComponentMeters`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();c.success?(alert("Configuration Saved!"),_(),f()):alert("Failed to save configuration: "+c.message)}catch(r){console.error(r),alert("Network error. Please try again.")}};return e.jsxs("div",{id:"component-meter-reinitializer-main-container",children:[e.jsxs("div",{id:"component-meter-reinitializer-component-heirarchy-container",children:[e.jsx(k,{selectedShipID:o}),e.jsx("div",{id:"component-meter-reinitializer-component-heirarchy-container-cover",style:{cursor:o?"pointer":"not-allowed",zIndex:o?-1:0}})]}),e.jsx("div",{id:"component-meter-reinitializer-form-main-container",children:p?.filter(n=>l?.profile_ids?.includes(n.PROFILE_ID))[0]?.form_ids.includes("F_CMR_001")&&e.jsxs("form",{onSubmit:g,children:[e.jsx("div",{id:"component-meter-reinitializer-form-header",children:e.jsx("h2",{children:"Component Meter Reinitialization"})}),l.emp_type==2?e.jsx("div",{id:"component-meter-reinitializer-form-main-container-select-ship-container",children:e.jsxs("select",{value:i.shipId||"",onChange:b,children:[e.jsx("option",{value:"",children:"Select Location"}),j.map(n=>e.jsx("option",{value:n.SHA_ID,children:n.ship_name},n.SHA_ID))]})}):e.jsxs("h2",{children:["You are at ",l.ship_id]}),e.jsxs("div",{id:"component-meter-reinitializer-form-main-container-selected-component-label",children:[e.jsxs("h3",{children:["Selected Component: ",t?.data?.label||"N/A"]}),t&&e.jsxs("small",{children:["Current Values: RH: ",t?.data?.working_counter_hr||0,", NM: ",t?.data?.km_counter||0,", IDL: ",t?.data?.replacement_day_counter||0]})]}),e.jsxs("div",{id:"component-meter-reinitializer-form-main-container-main-form-content-container",children:[e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx(A,{})," Current R. H."]}),e.jsx("input",{type:"number",value:i.rh,onChange:n=>m("rh",n.target.value),onKeyDown:h,disabled:!o})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Current N. M."}),e.jsx("input",{type:"number",value:i.nm,onChange:n=>m("nm",n.target.value),onKeyDown:h,disabled:!o})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Current Idle Counter"}),e.jsx("input",{type:"number",value:i.idl,onChange:n=>m("idl",n.target.value),onKeyDown:h,disabled:!o})]}),e.jsxs("div",{id:"movement-logs-checks-container",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:i.isMovementLogAffect===1,onChange:y,disabled:!o}),"is It Movement Log? and will It impact on Job Firing Process?"]}),i.isMovementLogAffect===1&&e.jsxs("div",{className:"impact-options",children:[e.jsx("label",{children:"Impacted On"}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"impact-on",value:"0",checked:i.impactOn===0,onChange:x})," Self Only"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"impact-on",value:"1",checked:i.impactOn===1,onChange:x})," Children Hierarchy"]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[p?.filter(n=>l?.profile_ids?.includes(n.PROFILE_ID))[0]?.process_ids.includes("P_CMR_0002")&&e.jsx("button",{type:"submit",disabled:!o||!t,children:"ğŸ’¾ Save Configuration"}),e.jsx("button",{type:"button",onClick:f,className:"secondary-button",children:"ğŸ—‘ï¸ Clear"})]})]})})]})};export{M as default};
