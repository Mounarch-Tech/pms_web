import{a as o,U as B,D as W,l as G,p as M,m as e,n as S}from"./index-Crjmc8rK.js";const Y=({selected_jcd_from_view_jcd_module:h,toggelVeiwJobsOnJCD:C,refreshClickedJcdData:P})=>{const k="https://pms.miscos.in/pms/server/api/",{user:g}=o.useContext(B),{designationList:I,refreshDesignationList:w}=o.useContext(W),{selectedNode:m}=o.useContext(G),n=h&&g.emp_type===1,{jobTypesIDandNameList:J,refreshJobTypesIDandName:q}=o.useContext(M),[y,N]=o.useState(!1),[b,x]=o.useState([]),[f,D]=o.useState(!1),[_,v]=o.useState([""]),[i,p]=o.useState({JTH_ID:"",SHA_ID:"",criticality:"",job_generation_type:[],operational_interval:"",time_scale:"",km_interval:"",periodic_interval:"",jcd_category:"",jcd_instruction_manual:null,jcd_check_list:[],status:"1",deactivated_by:"",deactivated_on:"",job_will_generate_on:[],lest_executed_status:"",consumable_spare1:"",consumable_spare2:"",consumable_spare3:"",consumable_spare4:"",consumable_spare5:"",consumable_spare6:"",consumable_spare7:"",consumable_spare8:"",consumable_spare9:"",consumable_spare10:"",executed_by:"",secondary_desg:"",first_verified_by:"",second_verified_by:"",image_required:"",video_required:"",extension_authority:"",jcd_applied_cat:"",jcd_applied_sub_cat:"",jcd_applied_2nd_sub_cat:"",jcd_applied_3rd_sub_cat:"",jcd_applied_part:""});o.useEffect(()=>{if(h){const s={...h};typeof s.job_generation_type=="string"&&(s.job_generation_type=s.job_generation_type.split(",").map(a=>a.trim())),typeof s.job_will_generate_on=="string"&&(s.job_will_generate_on=s.job_will_generate_on.split(",").map(a=>a.trim())),typeof s.jcd_check_list=="string"&&(s.jcd_check_list=s.jcd_check_list.split(",").map(a=>a.trim())),p(a=>T(s,a))}},[h]);function T(s,a){const t={...a};for(const l in s){if(!(l in a))continue;const r=s[l];["job_generation_type","job_will_generate_on","jcd_check_list"].includes(l)?typeof r=="string"?t[l]=r.split(",").map(d=>d.trim()).filter(Boolean):Array.isArray(r)?t[l]=r:t[l]=[]:t[l]=r}return t}o.useEffect(()=>{},[m]),o.useEffect(()=>{q(),w()},[]);const c=s=>{const{name:a,value:t,type:l,checked:r}=s.target;n||p(l==="checkbox"&&a==="job_generation_type"?d=>{const u=[...d.job_generation_type];if(r)u.push(t);else{const j=u.indexOf(t);j>-1&&u.splice(j,1)}return{...d,job_generation_type:u}}:l==="checkbox"?d=>{const u=[...d.job_will_generate_on];if(r)u.push(t);else{const j=u.indexOf(t);j>-1&&u.splice(j,1)}return{...d,job_will_generate_on:u}}:d=>({...d,[a]:t}))},H=s=>{if(n)return;const a=s.target.value,t=s.target.checked;p(l=>{const r=Array.isArray(l.job_generation_type)?l.job_generation_type:[],d=t?[...r,a]:r.filter(u=>u!==a);return{...l,job_generation_type:d}})},A=s=>{if(n)return;const a=s.target.files[0];p(t=>({...t,jcd_instruction_manual:a}))},E=(s,a)=>{if(n)return;const t=[...b];t[s]=a,x(t)},O=()=>{n||x([...b,""])},F=s=>{if(n||b.length<=1)return;const a=b.filter((t,l)=>l!==s);x(a)},R=()=>{n||_.length>=10||v([..._,""])},L=s=>{if(n||_.length<=1)return;const a=_.filter((l,r)=>r!==s);v(a);const t=`consumable_spare${s+1}`;p(l=>({...l,[t]:""}))},U=async s=>{if(s.preventDefault(),n){C("flex");return}if(i.job_generation_type.length===0){alert("Please select at least one Job Generation Type.");return}let a={...i};i.status==="2"&&(a.deactivated_by=g.EHA_ID,a.deactivated_on=new Date().toISOString().split("T")[0]),a.jcd_check_list=y?b:[],_.forEach((t,l)=>{const r=`consumable_spare${l+1}`;a[r]=i[r]||""});for(let t=_.length;t<10;t++)a[`consumable_spare${t+1}`]="";a.jcd_applied_cat=m.data.CHA_ID??null,a.jcd_applied_sub_cat=m.data.SCHA_ID??null,a.jcd_applied_2nd_sub_cat=m.data.SSCHA_ID??null,a.jcd_applied_3rd_sub_cat=m.data.TSCHA_ID??null,a.inserted_by=g.EHA_ID,a.inserted_on=new Date().toISOString().split("T")[0];try{if(h){a.JCDSHA_ID=h.JCDSHA_ID;const t=await S.put(`${k}updateJCDScheduleById`,a);alert(t.status===200?"JCD updated successfully!":"Unexpected response")}else{const t=await S.post(`${k}addJcd`,a);alert(t.status===200?"JCD saved successfully!":"Unexpected response")}}catch(t){console.error(t),alert("Error saving JCD.")}},$=()=>{p({JTH_ID:"",SHA_ID:"",criticality:"",job_generation_type:[],operational_interval:"",time_scale:"",km_interval:"",periodic_interval:"",jcd_category:"",jcd_instruction_manual:null,jcd_check_list:[],status:"1",deactivated_by:"",deactivated_on:"",job_will_generate_on:[],lest_executed_status:"",consumable_spare1:"",consumable_spare2:"",consumable_spare3:"",consumable_spare4:"",consumable_spare5:"",consumable_spare6:"",consumable_spare7:"",consumable_spare8:"",consumable_spare9:"",consumable_spare10:"",executed_by:"",secondary_desg:"",first_verified_by:"",second_verified_by:"",image_required:"",video_required:"",extension_authority:"",jcd_applied_cat:"",jcd_applied_sub_cat:"",jcd_applied_2nd_sub_cat:"",jcd_applied_3rd_sub_cat:"",jcd_applied_part:""}),N(!1),x([""]),D(!1),v([""])};return e.jsxs("div",{className:"jcd-main-container",children:[e.jsxs("h2",{children:["Configure Job On ",m.data.label.split(":")[0]]}),n&&e.jsxs("div",{className:"view-only-banner",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),"View-only mode: You are a location-side user and cannot edit this JCD."]}),e.jsxs("form",{onSubmit:U,className:"jcd-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selected Component:"}),e.jsx("big",{children:e.jsx("i",{style:{color:"#94a3b8"},children:m.data.label})})]}),e.jsx("div",{className:"form-group",children:e.jsxs("select",{name:"JTH_ID",onChange:c,value:i.JTH_ID,required:!0,disabled:n,className:"form-control",children:[e.jsx("option",{value:"",children:"Select Job Type"}),J.map(s=>e.jsx("option",{value:s.JTH_ID,children:s.JTH_job_type},s.JTH_ID))]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Criticality"}),["Critical","Non-critical"].map((s,a)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"criticality",value:a+1,checked:i.criticality==a+1,onChange:c,disabled:n,required:!0}),s]},s))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Generation Type"}),e.jsx("div",{className:"checkbox-group",children:[{value:"1",label:"Operational Time"},{value:"2",label:"KM"},{value:"3",label:"Periodic Days"}].map(({value:s,label:a})=>e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",value:s,checked:i.job_generation_type.includes(s),onChange:H,disabled:n}),a]},s))})]}),i.job_generation_type.includes("1")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"operational_interval",children:"Operational Interval"}),e.jsx("input",{type:"number",id:"operational_interval",name:"operational_interval",value:i.operational_interval,onChange:c,className:"form-control",disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"time_scale",children:"Time Scale"}),e.jsxs("select",{id:"time_scale",name:"time_scale",value:i.time_scale,onChange:c,className:"form-control",disabled:n,children:[e.jsx("option",{value:"",children:"Select Scale"}),e.jsx("option",{value:"1",children:"Hours"}),e.jsx("option",{value:"2",children:"Days"}),e.jsx("option",{value:"3",children:"Weeks"})]})]})]}),i.job_generation_type.includes("2")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"km_interval",children:"KM Interval"}),e.jsx("input",{type:"number",id:"km_interval",name:"km_interval",value:i.km_interval,onChange:c,className:"form-control",disabled:n})]}),i.job_generation_type.includes("3")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"periodic_interval",children:"Periodic Interval (Days)"}),e.jsx("input",{type:"number",id:"periodic_interval",name:"periodic_interval",value:i.periodic_interval,onChange:c,className:"form-control",disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Servicable Or Replacable"}),e.jsxs("select",{name:"jcd_category",onChange:c,value:i.jcd_category,required:!0,disabled:n,className:"form-control",children:[e.jsx("option",{value:"",children:"Select"}),[{value:"1",label:"Servicable"},{value:"2",label:"Replacable"}].map((s,a)=>e.jsx("option",{value:s.value,children:s.label},a))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Instruction Manual"}),e.jsx("input",{type:"file",name:"jcd_instruction_manual",accept:".pdf, .doc",onChange:A,disabled:n})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>!n&&N(s.target.checked),disabled:n}),"Do you want to add checklist to ensure quality work?"]})}),y&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Checklist Items"}),e.jsx("div",{className:"checklist-container",children:b.map((s,a)=>e.jsxs("div",{className:"checklist-item",children:[e.jsx("input",{type:"text",value:s,onChange:t=>E(a,t.target.value),disabled:n,placeholder:`Checklist ${a+1}`,className:"form-control",required:!0}),e.jsx("button",{type:"button",onClick:()=>F(a),disabled:n,children:"Remove"})]},a))}),e.jsxs("button",{type:"button",onClick:O,className:"add-button",disabled:n,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Checklist Item"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Will Generate On"}),e.jsx("div",{className:"checkbox-group",children:[1,2,3,4,5].map(s=>e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"job_will_generate_on",value:s,checked:i.job_will_generate_on.includes(s.toString()),onChange:c,disabled:n}),["Sealing","On Dock","Inactive","Under Repair","Other"][s-1]]},s))})]}),i.job_will_generate_on.includes("5")&&e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",placeholder:'Enter reason for selecting "Other"',autoFocus:!0,required:!0,disabled:n,className:"form-control"})}),["executed_by","secondary_desg","first_verified_by","second_verified_by","extension_authority"].map(s=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:s,children:s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),e.jsxs("select",{id:s,name:s,onChange:c,value:i[s],className:"form-control",required:s!=="extension_authority",style:{color:"#666464"},disabled:n,children:[e.jsxs("option",{value:"",children:["Select ",s.replace(/_/g," ")]}),I.map((a,t)=>e.jsx("option",{value:a.DSGH_ID,children:a.desg_name},t))]})]},s)),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image Required"}),[1,0].map(s=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"image_required",value:s,checked:i.image_required==s,onChange:c,disabled:n,required:!0}),s===1?"Yes":"No"]},s))]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Video Required"}),[1,0].map(s=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"video_required",value:s,checked:i.video_required==s,onChange:c,disabled:n,required:!0}),s===1?"Yes":"No"]},s))]}),i.jcd_category==="Replaceable"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>!n&&D(s.target.checked),disabled:n}),"Do you need any consumable spares to complete this job?"]})}),f&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontWeight:"bold",marginBottom:"8px",display:"block"},children:"Consumable Spares"}),e.jsx("div",{className:"checklist-container",children:_.map((s,a)=>{const t=`consumable_spare${a+1}`;return e.jsxs("div",{className:"checklist-item",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:`Consumable Spare ${a+1}`,value:i[t],onChange:l=>!n&&p(r=>({...r,[t]:l.target.value})),disabled:n,required:f}),e.jsx("button",{type:"button",onClick:()=>L(a),disabled:n,children:"Remove"})]},t)})}),_.length<10&&e.jsxs("button",{type:"button",onClick:R,className:"add-button",disabled:n,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add More"]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",disabled:n,children:n?"View Only":h?"Update":"Create"}),e.jsx("button",{type:"button",onClick:$,disabled:n,children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>C("flex"),disabled:n,children:"View jobs Count On this JCD"})]})]})]})};export{Y as default};
