import{a,S as Y,t as J,U as Q,m as e,q as X,n as c}from"./index-Crjmc8rK.js";const p="https://pms.miscos.in/pms/server/api/",te=()=>{const{shipsList:y}=a.useContext(Y),{departmentsList:Z}=a.useContext(J),{user:A}=a.useContext(Q),[n,L]=a.useState(""),[m,w]=a.useState(""),[o,x]=a.useState(""),[k,C]=a.useState(!1),[O,j]=a.useState(!1),[l,D]=a.useState(null),[T,$]=a.useState(null),[P,H]=a.useState([]),[N,h]=a.useState([]),[v,M]=a.useState([]),[g,S]=a.useState([]),[G,u]=a.useState(!1);function q(t){const s={};t.forEach(d=>{s[d.DSGH_ID]=d});function r(d){if(!d.reporting_to)return 1;const i=s[d.reporting_to];return i?r(i)+1:1}return t.map(d=>({...d,level:r(d)}))}a.useEffect(()=>{if(v.length>0){const t=q(v);S(t)}else S([])},[v]),a.useEffect(()=>{H(y)},y),a.useEffect(()=>{if(!n){h([]),x("");return}(async()=>{try{let s;if(n==="Ship"){if(!m){h([]);return}s=await c.get(`${p}/departments/${m}`)}else n==="Office"&&(s=await c.get(`${p}/office-departments`));s?.data?.success&&h(s.data.data)}catch(s){console.error("âŒ Failed to fetch departments:",s)}})()},[n,m]);const b=async()=>{try{const t=await c.get(`${p}/designations/${o}`);t.data.success&&M(t.data.data)}catch(t){console.error("âŒ Failed to fetch designations:",t)}};a.useEffect(()=>{if(!o){S([]);return}b()},[o]);const F=t=>{w(t),x("")},R=t=>{x(t)},V=()=>{if(n==="Ship"&&!m){alert("Please select a ship first.");return}C(!0)},B=()=>{if(!o){alert("Please select a department first.");return}j(!0),D(null)},U=t=>{D(t),j(!0)},W=async t=>{try{(await c.put(`${p}/designation/suspend/${t}`)).data.success&&(alert("âœ… Designation suspended successfully."),b(),u(!1))}catch(s){console.error("âŒ Error suspending designation:",s),alert("Failed to suspend designation."),u(!1)}},f=()=>{C(!1),j(!1),D(null)},z=async t=>{t.preventDefault();const s=new FormData(t.target),r=s.get("departmentName").trim(),d=s.get("departmentCode").trim()||null;if(!r){alert("Department name is required.");return}try{const i={dept_name:r,operational_location:n,dept_code:d};if(n==="Ship"&&(i.ship_id=m),(await c.post(`${p}/department`,i)).data.success){if(n==="Ship"){const _=await c.get(`${p}/departments/${m}`);h(_.data.data)}else{const _=await c.get(`${p}/office-departments`);h(_.data.data)}f(),alert("âœ… Department added successfully.")}}catch(i){console.error("âŒ Error adding department:",i);const E=i.response?.data?.message||"Failed to add department.";alert(E)}},K=async t=>{t.preventDefault();const s=new FormData(t.target),r={desg_name:s.get("designationName").trim(),reporting_to:s.get("reportTo"),no_of_positions:parseInt(s.get("posts"))||1,operational_location:n,desg_code:s.get("designationCode").trim()};if(!r.desg_name){alert("Designation name is required.");return}try{let d;l?d=await c.put(`${p}/designation/${l.DSGH_ID}`,r):d=await c.post(`${p}/designation`,{...r,DEPT_ID:o}),d.data.success&&(alert(l?"âœ… Designation updated successfully.":"âœ… Designation added successfully."),b(),f())}catch(d){const i=d.response?.data?.message||"Failed to save designation.";alert(i)}},I=N.find(t=>t.DEPT_ID===o)?.dept_name;return e.jsxs("div",{className:"slate-dd-container",children:[e.jsx("h1",{className:"slate-dd-title",children:"Departments & Designations"}),e.jsxs("div",{className:"slate-dd-control-panel",children:[e.jsxs("div",{className:"slate-dd-select-card",children:[e.jsx("label",{className:"slate-dd-label",children:"Operational Location"}),e.jsxs("select",{value:n,onChange:t=>{L(t.target.value),w(""),x("")},className:"slate-dd-select-input",children:[e.jsx("option",{value:"",children:"-- Select Location --"}),e.jsx("option",{value:"Ship",children:"Location ðŸ­"}),e.jsx("option",{value:"Office",children:"Office ðŸ¢"})]})]}),e.jsxs("div",{className:"slate-dd-select-card",children:[e.jsx("label",{className:"slate-dd-label",children:"Location"}),e.jsxs("select",{disabled:n!=="Ship",value:m,onChange:t=>F(t.target.value),className:`slate-dd-select-input ${n!=="Ship"?"slate-dd-disabled":""}`,children:[e.jsx("option",{value:"",children:n==="Ship"?"-- Select Location --":"N/A for Office"}),P.map(t=>e.jsxs("option",{value:t.SHA_ID,children:[t.ship_name," (",t.ship_code,")"]},t.SHA_ID))]})]})]}),e.jsxs("div",{className:"slate-dd-main-content",children:[e.jsxs("div",{className:"slate-dd-department-sidebar",children:[e.jsxs("div",{className:"slate-dd-panel-header",children:[e.jsx("h3",{children:"Departments"}),e.jsx("button",{onClick:V,className:"slate-dd-btn slate-dd-btn-icon",disabled:!n||n==="Ship"&&!m,title:"Add New Department",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]}),n?e.jsx("div",{className:"slate-dd-list-container",children:N.length>0?N.map(t=>e.jsxs("button",{onClick:()=>R(t.DEPT_ID),className:`slate-dd-list-item ${o===t.DEPT_ID?"slate-dd-list-item-active":""}`,children:[e.jsx("span",{children:t.dept_name}),e.jsx("span",{className:"slate-dd-list-item-code",children:t.dept_code})]},t.DEPT_ID)):e.jsx("p",{className:"slate-dd-placeholder-small",children:"No departments. Click + to add one."})}):e.jsx("p",{className:"slate-dd-placeholder-small",children:"Select Operational Location and specific Location first."})]}),e.jsxs("div",{className:"slate-dd-designation-panel",children:[e.jsxs("div",{className:"slate-dd-panel-header",children:[e.jsxs("h3",{children:["Designations for: ",e.jsx("span",{className:"slate-dd-highlight-text",children:I||"---"})]}),e.jsx("button",{onClick:B,className:"slate-dd-btn slate-dd-btn-accent",disabled:!o,title:"Add New Designation",children:"+ New Designation"})]}),o?e.jsx("div",{className:"slate-dd-table-wrapper",children:e.jsxs("table",{className:"slate-dd-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"slate-dd-th-level",children:"Level"}),e.jsx("th",{children:"Designation "}),e.jsx("th",{children:"Reports To"}),e.jsx("th",{className:"slate-dd-th-post",children:"Posts"}),e.jsx("th",{className:"slate-dd-th-actions",children:"Actions"})]})}),e.jsx("tbody",{children:g.length>0?g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"slate-dd-td-level",children:t.level}),e.jsx("td",{children:e.jsx("strong",{children:t.desg_name})}),e.jsx("td",{children:g.find(s=>s.DSGH_ID==t.reporting_to)?.desg_name||e.jsx("span",{className:"slate-dd-top-authority",children:"TOP AUTHORITY"})}),e.jsx("td",{className:"slate-dd-td-post",children:t.no_of_positions}),e.jsxs("td",{className:"slate-dd-td-actions",children:[e.jsx("button",{onClick:()=>U(t),className:"slate-dd-btn slate-dd-btn-sm slate-dd-btn-edit",title:"Edit Designation",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})}),e.jsx("button",{onClick:()=>{$(t.DSGH_ID),u(!0)},className:"slate-dd-btn slate-dd-btn-sm slate-dd-btn-danger",title:"Suspend Designation",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]})})]})]},t.DSGH_ID)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"slate-dd-table-empty",children:["No designations found in ",I||"this department","."]})},"no-data")})]})}):e.jsx("div",{className:"slate-dd-placeholder-large",children:e.jsx("p",{children:"ðŸ‘ˆ Select a department to view and manage positions."})})]})]}),k&&e.jsx("div",{className:"slate-dd-modal-overlay",children:e.jsxs("div",{className:"slate-dd-modal",children:[e.jsx("h3",{children:"Add New Department"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"Department Name"}),e.jsx("input",{type:"text",name:"departmentName",placeholder:"e.g., Engine Department, HR",required:!0,className:"slate-dd-input"})]}),e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"Department Code "}),e.jsx("input",{type:"text",name:"departmentCode",placeholder:"e.g., ENG,DECK,NAV",className:"slate-dd-input",required:!0})]}),e.jsxs("div",{className:"slate-dd-modal-actions",children:[e.jsx("button",{type:"button",onClick:f,className:"slate-dd-btn slate-dd-btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"slate-dd-btn slate-dd-btn-primary",children:"Save Department"})]})]})]})}),G&&e.jsx(X,{onVerifySuccess:()=>{window.confirm("Are you sure you want to suspend this designation?")?W(T):u(!1)},onCancel:()=>{u(!1)},to:A.emp_email}),O&&e.jsx("div",{className:"slate-dd-modal-overlay",children:e.jsxs("div",{className:"slate-dd-modal",children:[e.jsx("h3",{children:l?"Edit Designation":"Add New Designation"}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"Designation Name"}),e.jsx("input",{type:"text",name:"designationName",defaultValue:l?.desg_name||"",placeholder:"e.g., Chief Engineer, Accountant",required:!0,className:"slate-dd-input"})]}),e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"Designation Code "}),e.jsx("input",{type:"text",name:"designationCode",defaultValue:l?.desg_code||"",placeholder:"e.g., C/E, ACCT",className:"slate-dd-input",required:!0})]}),e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"No of Positions / Posts"}),e.jsx("input",{type:"number",name:"posts",defaultValue:l?.no_of_positions||1,min:"1",className:"slate-dd-input"})]}),e.jsxs("div",{className:"slate-dd-form-group",children:[e.jsx("label",{children:"Reporting To (Select Superior)"}),e.jsxs("select",{name:"reportTo",defaultValue:l?.reporting_to||"",className:"slate-dd-select-input",children:[e.jsx("option",{value:"",children:"-- Top Authority  --"}),g.filter(t=>l?t.DSGH_ID!==l.DSGH_ID&&t.level<(l.level||1/0):!0).map(t=>e.jsxs("option",{value:t.DSGH_ID,children:["L",t.level,": ",t.desg_name]},t.DSGH_ID))]})]}),e.jsxs("div",{className:"slate-dd-modal-actions",children:[e.jsx("button",{type:"button",onClick:f,className:"slate-dd-btn slate-dd-btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:`slate-dd-btn ${l?"slate-dd-btn-edit":"slate-dd-btn-primary"}`,children:l?"Update Designation":"Save Designation"})]})]})]})})]})};export{te as default};
